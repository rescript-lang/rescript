// Generated by ReScript, PLEASE EDIT WITH CARE
'use strict';

var Js_exn = require("rescript/lib/js/js_exn.js");
var Belt_List = require("rescript/lib/js/belt_List.js");
var Caml_array = require("rescript/lib/js/caml_array.js");
var Caml_option = require("rescript/lib/js/caml_option.js");
var Caml_exceptions = require("rescript/lib/js/caml_exceptions.js");
var Caml_js_exceptions = require("rescript/lib/js/caml_js_exceptions.js");

var tests = [];

function addTest(t) {
  tests.push(t);
}

function addTest1(t, x) {
  tests.push(function () {
        return t(x);
      });
}

async function foo(x, y) {
  return x + y | 0;
}

async function bar(ff) {
  var a = await ff(3, 4);
  var b = await foo(5, 6);
  return a + b | 0;
}

async function baz() {
  return await bar(foo);
}

async function testBaz() {
  var n = await baz();
  console.log("baz returned", n);
}

tests.push(testBaz);

var E = /* @__PURE__ */Caml_exceptions.create("AA.E");

async function e1() {
  throw {
        RE_EXN_ID: E,
        _1: 1000,
        Error: new Error()
      };
}

async function e2() {
  return Js_exn.raiseError("Some JS error");
}

async function e3() {
  return await e1();
}

async function e4() {
  return await e2();
}

var e5 = (function() { return Promise.reject(new Error('fail')) });

async function testTryCatch(fn) {
  try {
    return await fn();
  }
  catch (raw_n){
    var n = Caml_js_exceptions.internalToOCamlException(raw_n);
    if (n.RE_EXN_ID === E) {
      console.log("testTryCatch: E", n._1);
      return ;
    }
    if (n.RE_EXN_ID === "JsError") {
      console.log("testTryCatch: JsError");
      return ;
    }
    throw n;
  }
}

addTest1(testTryCatch, e1);

addTest1(testTryCatch, e2);

addTest1(testTryCatch, e3);

addTest1(testTryCatch, e4);

addTest1(testTryCatch, e5);

async function singlePromise(x) {
  return x + 1 | 0;
}

async function nestedPromise(x) {
  var x$1 = singlePromise(x + 1 | 0);
  [Promise.resolve(x$1)];
  return 32;
}

var explainError = ((e)=>e.toString());

async function testFetch(url) {
  var response;
  try {
    response = await fetch(url);
  }
  catch (raw_e){
    var e = Caml_js_exceptions.internalToOCamlException(raw_e);
    if (e.RE_EXN_ID === "JsError") {
      console.log("Fetch returned an error:", explainError(e._1));
      return ;
    }
    throw e;
  }
  var status = response.status;
  console.log("Fetch returned status:", status);
}

addTest1(testFetch, "https://www.google.com/sdkjdkghdsg");

addTest1(testFetch, "https://www.google.comsdkjdkghdsg");

async function withCallback() {
  return async function (x) {
    return await Promise.resolve(x) + 1 | 0;
  };
}

async function testWithCallback() {
  console.log("callback returned", await (await withCallback())(3));
}

tests.push(testWithCallback);

async function map(l, f) {
  var loop = async function (l, acc) {
    if (l) {
      return await loop(l.tl, {
                  hd: await l.hd,
                  tl: acc
                });
    } else {
      return acc;
    }
  };
  return await loop(Belt_List.mapReverse(l, (function (x) {
                    return f(x);
                  })), /* [] */0);
}

var AsyncList = {
  map: map
};

var counter = {
  contents: 0
};

async function ff(url) {
  var response = await fetch(url);
  counter.contents = counter.contents + 1 | 0;
  return [
          counter.contents,
          response.status
        ];
}

async function testFetchMany() {
  return Belt_List.forEach(await map({
                  hd: "https://www.google.com",
                  tl: {
                    hd: "https://www.google.com",
                    tl: {
                      hd: "https://www.google.com",
                      tl: {
                        hd: "https://www.google.com",
                        tl: {
                          hd: "https://www.google.com",
                          tl: /* [] */0
                        }
                      }
                    }
                  }
                }, ff), (function (param) {
                console.log("Fetched", param[0], param[1]);
              }));
}

tests.push(testFetchMany);

async function runAllTests(n) {
  if (n >= 0 && n < tests.length) {
    await Caml_array.get(tests, n)();
    return await runAllTests(n + 1 | 0);
  }
  
}

runAllTests(0);

async function bb(x) {
  return await x;
}

async function cc(x, yOpt, z) {
  var y = yOpt !== undefined ? Caml_option.valFromOption(yOpt) : x;
  return (await x + await y | 0) + await z | 0;
}

var fetchAndCount = ff;

exports.tests = tests;
exports.addTest = addTest;
exports.addTest1 = addTest1;
exports.foo = foo;
exports.bar = bar;
exports.baz = baz;
exports.testBaz = testBaz;
exports.E = E;
exports.e1 = e1;
exports.e2 = e2;
exports.e3 = e3;
exports.e4 = e4;
exports.e5 = e5;
exports.testTryCatch = testTryCatch;
exports.singlePromise = singlePromise;
exports.nestedPromise = nestedPromise;
exports.explainError = explainError;
exports.testFetch = testFetch;
exports.withCallback = withCallback;
exports.testWithCallback = testWithCallback;
exports.AsyncList = AsyncList;
exports.fetchAndCount = fetchAndCount;
exports.testFetchMany = testFetchMany;
exports.runAllTests = runAllTests;
exports.bb = bb;
exports.cc = cc;
/*  Not a pure module */
