%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#e8f4fd', 'primaryTextColor': '#1a1a1a', 'primaryBorderColor': '#4a90d9', 'lineColor': '#4a90d9', 'secondaryColor': '#f0f7e6', 'tertiaryColor': '#fff5e6'}}}%%
flowchart TB
    subgraph FileLayer["File Layer"]
        RFC[("RFC")]
    end

    subgraph FileData["Per-File Data"]
        FD["FD"]
    end

    subgraph Extracted["Extracted"]
        DECLS["D"]
        ANNOT["A"]
        VREFS["VR"]
        TREFS["TR"]
        CFI["CFI"]
    end

    subgraph TypeDeps["ReactiveTypeDeps"]
        DBP["DBP"]
        SPR["SPR"]
        I2I["I2I"]
        I2I2["I2I₂"]
        INT2IMP["I→I"]
    end

    subgraph ExcDeps["ReactiveExceptionRefs"]
        EXCREF["ER"]
        EXCDECL["ED"]
        RESOLVED["RR"]
    end

    subgraph Output["Output"]
        REFS["REFS"]
    end

    RFC -->|"process"| FD
    FD -->|"flatMap"| DECLS
    FD -->|"flatMap"| ANNOT
    FD -->|"flatMap"| VREFS
    FD -->|"flatMap"| TREFS
    FD -->|"flatMap"| CFI

    DECLS -->|"flatMap"| DBP
    DBP -->|"flatMap"| SPR
    DBP -->|"join"| I2I
    DBP -->|"join"| I2I2
    DBP -->|"join"| INT2IMP

    CFI -->|"flatMap"| EXCREF
    DECLS -->|"flatMap"| EXCDECL
    EXCREF -->|"join"| RESOLVED
    EXCDECL -->|"join"| RESOLVED

    VREFS --> REFS
    TREFS --> REFS
    SPR --> REFS
    I2I --> REFS
    I2I2 --> REFS
    INT2IMP --> REFS
    RESOLVED --> REFS

    classDef fileLayer fill:#e8f4fd,stroke:#4a90d9,stroke-width:2px
    classDef extracted fill:#f0f7e6,stroke:#6b8e23,stroke-width:2px
    classDef typeDeps fill:#fff5e6,stroke:#d4a574,stroke-width:2px
    classDef excDeps fill:#f5e6ff,stroke:#9966cc,stroke-width:2px
    classDef output fill:#e6ffe6,stroke:#2e8b2e,stroke-width:2px

    class RFC,FD fileLayer
    class DECLS,ANNOT,VREFS,TREFS,CFI extracted
    class DBP,SPR,I2I,I2I2,INT2IMP typeDeps
    class EXCREF,EXCDECL,RESOLVED excDeps
    class REFS output

