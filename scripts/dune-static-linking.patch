From 25b42b96591d7a682b5884160b54b5da8dd3036d Mon Sep 17 00:00:00 2001
From: Christoph Knittel <ck@cca.io>
Date: Sat, 26 Nov 2022 10:04:01 +0100
Subject: [PATCH] Static linking

---
 jscomp/bsb_exe/dune        | 3 ++-
 jscomp/bsb_helper_exe/dune | 3 ++-
 jscomp/bsc/dune            | 3 ++-
 jscomp/cmij/dune           | 3 ++-
 jscomp/ounit_tests/dune    | 3 ++-
 res_syntax/benchmarks/dune | 3 ++-
 res_syntax/cli/dune        | 3 ++-
 res_syntax/testrunner/dune | 3 ++-
 8 files changed, 16 insertions(+), 8 deletions(-)

diff --git a/jscomp/bsb_exe/dune b/jscomp/bsb_exe/dune
index e75592a47..369a1c1fa 100644
--- a/jscomp/bsb_exe/dune
+++ b/jscomp/bsb_exe/dune
@@ -2,5 +2,6 @@
  (name rescript_main)
  (public_name rescript)
  (flags
-  (:standard -w +a-4-9-40-41-42-70))
+  (:standard -w +a-4-9-40-41-42-70)
+  (-cclib -static -cclib -no-pie))
  (libraries bsb common ext str unix))
diff --git a/jscomp/bsb_helper_exe/dune b/jscomp/bsb_helper_exe/dune
index 97b94ea21..44cce01af 100644
--- a/jscomp/bsb_helper_exe/dune
+++ b/jscomp/bsb_helper_exe/dune
@@ -2,5 +2,6 @@
  (name bsb_helper_main)
  (public_name bsb_helper)
  (flags
-  (:standard -w +a-9-40-42))
+  (:standard -w +a-9-40-42)
+  (-cclib -static -cclib -no-pie))
  (libraries bsb_helper))
diff --git a/jscomp/bsc/dune b/jscomp/bsc/dune
index 61b3e4c8e..a8562e9ba 100644
--- a/jscomp/bsc/dune
+++ b/jscomp/bsc/dune
@@ -2,6 +2,7 @@
  (name rescript_compiler_main)
  (public_name bsc)
  (flags
-  (:standard -w +a-4-9-30-40-41-42-48-70))
+  (:standard -w +a-4-9-30-40-41-42-48-70)
+  (-cclib -static -cclib -no-pie))
  (libraries common core depends gentype js_parser syntax super_errors
    outcome_printer))
diff --git a/jscomp/cmij/dune b/jscomp/cmij/dune
index bf4a01267..b528fa202 100644
--- a/jscomp/cmij/dune
+++ b/jscomp/cmij/dune
@@ -2,5 +2,6 @@
  (names cmij_main cmjdump_main)
  (public_names cmij cmjdump)
  (flags
-  (:standard -w +a-4-9-40-42-69))
+  (:standard -w +a-4-9-40-42-69)
+  (-cclib -static -cclib -no-pie))
  (libraries core))
diff --git a/jscomp/ounit_tests/dune b/jscomp/ounit_tests/dune
index 284fb6392..973731e5e 100644
--- a/jscomp/ounit_tests/dune
+++ b/jscomp/ounit_tests/dune
@@ -2,5 +2,6 @@
  (name ounit_tests_main)
  (public_name ounit_tests)
  (flags
-  (:standard -w +a-4-9-30-40-41-42-48-70))
+  (:standard -w +a-4-9-30-40-41-42-48-70)
+  (-cclib -static -cclib -no-pie))
  (libraries bsb bsb_helper core ounit2))
diff --git a/res_syntax/benchmarks/dune b/res_syntax/benchmarks/dune
index 926a60d0f..c1cb06626 100644
--- a/res_syntax/benchmarks/dune
+++ b/res_syntax/benchmarks/dune
@@ -11,7 +11,8 @@
    (= %{system} linux_eabihf)
    (= %{system} linux_eabi)))
  (flags
-  (:standard -w +a-4-40-42-70))
+  (:standard -w +a-4-40-42-70)
+  (-cclib -static -cclib -no-pie))
  (foreign_stubs
   (language c)
   (names time))
diff --git a/res_syntax/cli/dune b/res_syntax/cli/dune
index 3edb2f35b..4a01ebfed 100644
--- a/res_syntax/cli/dune
+++ b/res_syntax/cli/dune
@@ -2,5 +2,6 @@
  (name res_cli)
  (public_name res_parser)
  (flags
-  (:standard -w +a-4-42-40-9-48-70))
+  (:standard -w +a-4-42-40-9-48-70)
+  (-cclib -static -cclib -no-pie))
  (libraries syntax))
diff --git a/res_syntax/testrunner/dune b/res_syntax/testrunner/dune
index 133afd89d..7a1a3c82c 100644
--- a/res_syntax/testrunner/dune
+++ b/res_syntax/testrunner/dune
@@ -2,5 +2,6 @@
  (name res_test)
  (public_name syntax_tests)
  (flags
-  (:standard -w +a-40-42-70))
+  (:standard -w +a-40-42-70)
+  (-cclib -static -cclib -no-pie))
  (libraries syntax core))
-- 
2.36.1

